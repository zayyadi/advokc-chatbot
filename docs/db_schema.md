# PostgreSQL Database Schema

This document defines the database schema for the ADVOKC Chatbot project using PostgreSQL.

## Table: `politicians`

Stores information about politicians whose promises are tracked.

-   `politician_id` (SERIAL PRIMARY KEY): Unique identifier for the politician.
-   `name` (VARCHAR(255) NOT NULL): Full name of the politician.
-   `political_party` (VARCHAR(100)): Political party affiliation.
-   `office` (VARCHAR(255)): The office they hold or ran for.
-   `created_at` (TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP): Timestamp of record creation.
-   `updated_at` (TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP): Timestamp of last update.

## Table: `promises`

Tracks promises made by politicians.

-   `promise_id` (SERIAL PRIMARY KEY): Unique identifier for the promise.
-   `politician_id` (INTEGER NOT NULL REFERENCES `politicians`(`politician_id`)): Foreign key linking to the politician who made the promise.
-   `promise_title` (VARCHAR(255) NOT NULL): A concise title for the promise.
-   `promise_description` (TEXT NOT NULL): Detailed description of the promise.
-   `category` (VARCHAR(100)): Category of the promise (e.g., "Education", "Healthcare", "Infrastructure").
-   `date_made` (DATE): Date when the promise was made.
-   `source_url` (TEXT): URL of the source where the promise was recorded (e.g., news article, campaign manifesto).
-   `status` (VARCHAR(50) DEFAULT 'Pending'): Current status of the promise (e.g., "Pending", "In Progress", "Fulfilled", "Broken", "Partially Fulfilled").
-   `status_update_date` (DATE): Date when the status was last updated.
-   `evidence_url` (TEXT): URL to evidence supporting the current status.
-   `created_at` (TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP): Timestamp of record creation.
-   `updated_at` (TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP): Timestamp of last update.

## Table: `civic_documents`

Stores metadata about ingested civic documents used for the RAG system.

-   `doc_id` (SERIAL PRIMARY KEY): Unique identifier for the document.
-   `title` (VARCHAR(255) NOT NULL): Title of the document.
-   `source_description` (TEXT): Description of the document's origin (e.g., "Nigerian Constitution 1999", "Freedom of Information Act 2011").
-   `document_type` (VARCHAR(100)): Type of document (e.g., "Constitution", "Act", "Policy Paper").
-   `publication_date` (DATE): Date the document was published or enacted.
-   `url_link` (TEXT): Link to the original document if available online.
-   `ingested_at` (TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP): Timestamp when the document was added to the system.

## Table: `document_chunks`

Stores chunks of text from civic documents, used for vector embeddings in the RAG system. This table is primarily for reference; the main storage for RAG will be the Vector DB (ChromaDB).

-   `chunk_id` (SERIAL PRIMARY KEY): Unique identifier for the text chunk.
-   `doc_id` (INTEGER NOT NULL REFERENCES `civic_documents`(`doc_id`)): Foreign key linking to the parent document.
-   `chunk_text` (TEXT NOT NULL): The actual text content of the chunk.
-   `chunk_metadata` (JSONB): Additional metadata about the chunk (e.g., page number, section).
-   `embedding_id` (VARCHAR(255) UNIQUE): Optional reference ID to the corresponding embedding in ChromaDB, if needed for direct lookup.
-   `created_at` (TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP): Timestamp of record creation.

## Table: `query_logs`

Logs user queries and the chatbot's responses.

-   `log_id` (SERIAL PRIMARY KEY): Unique identifier for the log entry.
-   `session_id` (VARCHAR(255)): Identifier for a user's session (can be generated by the backend).
-   `user_query` (TEXT NOT NULL): The query submitted by the user.
-   `retrieved_context` (TEXT): The context retrieved by the RAG system (optional, for analysis).
-   `llm_prompt` (TEXT): The full prompt sent to the LLM (optional, for debugging).
-   `llm_response` (TEXT): The response generated by the LLM.
-   `response_time_ms` (INTEGER): Time taken to generate the response in milliseconds.
-   `timestamp` (TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP): Time of the query.
-   `user_feedback_score` (SMALLINT): User feedback on the response (e.g., 1-5 stars, or -1 for downvote, 1 for upvote).
-   `user_feedback_comment` (TEXT): Any textual feedback from the user.
-   `error_message` (TEXT): If any error occurred during processing.

## Table: `advokc_info`

Stores information about ADVOKC's activities and advocacy efforts. This could be a simple key-value store or structured content.

-   `info_id` (SERIAL PRIMARY KEY): Unique identifier for the information entry.
-   `info_key` (VARCHAR(255) UNIQUE NOT NULL): A unique key to identify the piece of information (e.g., "mission_statement", "contact_details", "current_campaigns").
-   `info_title` (VARCHAR(255) NOT NULL): A user-friendly title for the information.
-   `info_content` (TEXT NOT NULL): The detailed content for this key.
-   `category` (VARCHAR(100)): Category of information (e.g., "About Us", "Advocacy", "Events").
-   `last_updated` (TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP): Timestamp of the last update.

---

**General Notes:**

-   **Timestamps:** `created_at` and `updated_at` fields are good practice for tracking changes. Consider using database triggers to automatically update `updated_at`.
-   **Indexing:** Appropriate indexes should be created on foreign keys, frequently queried columns (e.g., `promises.status`, `politicians.name`, `query_logs.timestamp`), and columns used in `WHERE` clauses to optimize query performance.
-   **JSONB vs. TEXT:** `JSONB` is used for `chunk_metadata` for efficient querying of structured metadata. `TEXT` is suitable for longer, unstructured text.
-   **Normalization:** The schema aims for a reasonable level of normalization. Further normalization or denormalization might be considered based on specific query patterns and performance requirements.
-   **Vector DB (ChromaDB):** While `document_chunks` is defined here for reference and potential metadata storage, the primary storage and retrieval mechanism for document embeddings for the RAG system will be ChromaDB. The `embedding_id` in `document_chunks` could serve as a link if needed.

This schema provides a foundation. It may evolve as the project requirements become more detailed.
